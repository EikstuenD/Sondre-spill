<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>CodeRacer 3D â€“ BMW M4 Comp</title>
<style>
 body { margin:0; overflow:hidden; background:black; }
 #hud {
   position:absolute;
   bottom:20px;
   left:20px;
   color:#0f0;
   font-family:Arial;
   font-size:22px;
   background:rgba(0,0,0,0.6);
   padding:12px 18px;
   border-radius:12px;
 }
</style>
</head>
<body>
<div id="hud">0 km/t</div>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>
// ================= SCENE =================
const scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x87ceeb, 50, 600);
scene.background = new THREE.Color(0x87ceeb);
const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 2000);
const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(innerWidth, innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);
// ================= LYS =================
scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 0.6));
const sun = new THREE.DirectionalLight(0xffffff, 1);
sun.position.set(100,200,100);
sun.castShadow = true;
scene.add(sun);
// ================= VERDEN =================
const ground = new THREE.Mesh(
 new THREE.PlaneGeometry(4000,4000),
 new THREE.MeshStandardMaterial({ color:0x1f7a3f })
);
ground.rotation.x = -Math.PI/2;
ground.receiveShadow = true;
scene.add(ground);
// Asfalt
const road = new THREE.Mesh(
 new THREE.PlaneGeometry(20,4000),
 new THREE.MeshStandardMaterial({ color:0x222222 })
);
road.rotation.x = -Math.PI/2;
road.position.y = 0.01;
road.receiveShadow = true;
scene.add(road);
// By
for(let i=0;i<120;i++){
 const h = Math.random()*80+20;
 const b = new THREE.Mesh(
   new THREE.BoxGeometry(20,h,20),
   new THREE.MeshStandardMaterial({ color:0x666666 })
 );
 b.position.set(
   Math.random()*600-300,
   h/2,
   Math.random()*600-300
 );
 b.castShadow = true;
 scene.add(b);
}
// ================= BIL =================
const car = new THREE.Mesh(
 new THREE.BoxGeometry(2.1,1.2,4.6),
 new THREE.MeshStandardMaterial({
   color:0x0044ff,
   metalness:0.6,
   roughness:0.3
 })
);
car.position.y = 0.6;
car.castShadow = true;
scene.add(car);
// ================= FYSIKK =================
let speed = 0;                 // m/s
const maxSpeed = 83.3;         // 300 km/t
const accel = 0.8;
const brake = 1.2;
const drag = 0.992;
const turnSpeed = 1.4;         // RAD/s
const keys = {};
onkeydown = e => keys[e.key]=true;
onkeyup   = e => keys[e.key]=false;
// ================= LYD =================
const engine = new Audio("https://cdn.pixabay.com/audio/2022/03/15/audio_1a61c7e2bb.mp3");
engine.loop = true;
engine.volume = 0.5;
onclick = ()=> engine.play();
// ================= KAMERA =================
const chaseOffset = new THREE.Vector3(0,4,-10);
// ================= LOOP =================
let last = performance.now();
function loop(now){
 requestAnimationFrame(loop);
 const dt = (now-last)/1000;
 last = now;
 // GASS
 if(keys["w"]) speed += accel;
 if(keys["s"]) speed -= brake;
 speed *= drag;
 speed = Math.max(Math.min(speed,maxSpeed), -20);
 // SVING (uavhengig av fart)
 if(keys["a"]) car.rotation.y += turnSpeed * dt;
 if(keys["d"]) car.rotation.y -= turnSpeed * dt;
 car.translateZ(speed * dt);
 // CHASE CAM
 const camPos = chaseOffset.clone().applyMatrix4(car.matrixWorld);
 camera.position.lerp(camPos, 0.15);
 camera.lookAt(car.position.x, car.position.y+1, car.position.z);
 // LYD
 engine.playbackRate = 0.6 + Math.abs(speed)/maxSpeed * 1.4;
 // HUD
 document.getElementById("hud").innerText =
   Math.abs(speed*3.6).toFixed(0) + " km/t";
 renderer.render(scene,camera);
}
loop(performance.now());
</script>
</body>
</html>
