<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>CodeRacer 3D – BMW M4 Comp</title>
<style>

  body { margin: 0; overflow: hidden; background: black; }

  #hud {

    position: absolute;

    bottom: 20px;

    left: 20px;

    color: white;

    font-family: Arial;

    font-size: 20px;

    background: rgba(0,0,0,0.4);

    padding: 10px 15px;

    border-radius: 10px;

  }
</style>
</head>
<body>
<div id="hud">0 km/t</div>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>

/* =========================

   SCENE / RENDERER

========================= */

const scene = new THREE.Scene();

scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(

  75, window.innerWidth/window.innerHeight, 0.1, 2000

);

const renderer = new THREE.WebGLRenderer({ antialias:true });

renderer.setSize(window.innerWidth, window.innerHeight);

document.body.appendChild(renderer.domElement);

/* =========================

   LYS

========================= */

scene.add(new THREE.AmbientLight(0xffffff, 0.4));

const sun = new THREE.DirectionalLight(0xffffff, 0.8);

sun.position.set(100,200,100);

scene.add(sun);

/* =========================

   VERDEN

========================= */

const ground = new THREE.Mesh(

  new THREE.PlaneGeometry(2000,2000),

  new THREE.MeshStandardMaterial({ color:0x2c7a3f })

);

ground.rotation.x = -Math.PI/2;

scene.add(ground);

// Lang motorvei

const road = new THREE.Mesh(

  new THREE.BoxGeometry(20,0.2,2000),

  new THREE.MeshStandardMaterial({ color:0x333333 })

);

road.position.y = 0.1;

scene.add(road);

// Bygninger

for(let i=0;i<80;i++){

  const h = Math.random()*60+20;

  const b = new THREE.Mesh(

    new THREE.BoxGeometry(20,h,20),

    new THREE.MeshStandardMaterial({ color:0x777777 })

  );

  b.position.set(

    Math.random()*400-200,

    h/2,

    Math.random()*400-200

  );

  scene.add(b);

}

/* =========================

   BMW M4 (PLACEHOLDER)

========================= */

const car = new THREE.Mesh(

  new THREE.BoxGeometry(2.1,1.2,4.6),

  new THREE.MeshStandardMaterial({ color:0x0055ff })

);

car.position.y = 0.6;

scene.add(car);

/* =========================

   FYSIKK (BMW M4 COMP)

========================= */

let speed = 0;

const maxSpeed = 78;      // ~280 km/t (78 m/s)

const accel = 0.15;

const brake = 0.25;

const friction = 0.985;

const turnStrength = 0.035;

const keys = {};

window.addEventListener("keydown", e=>keys[e.key]=true);

window.addEventListener("keyup", e=>keys[e.key]=false);

/* =========================

   MOTORLYD

========================= */

const audio = new Audio();

audio.src = "https://cdn.pixabay.com/download/audio/2022/03/15/audio_1a61c7e2bb.mp3";

audio.loop = true;

audio.volume = 0.4;

window.addEventListener("click", ()=>{

  if(audio.paused) audio.play();

});

/* =========================

   HUD

========================= */

const hud = document.getElementById("hud");

/* =========================

   CHASE CAM

========================= */

const camOffset = new THREE.Vector3(0,3,-8);

/* =========================

   GAME LOOP

========================= */

function animate(){

  requestAnimationFrame(animate);

  // GASS / BREMS

  if(keys["w"]) speed += accel;

  if(keys["s"]) speed -= brake;

  speed *= friction;

  speed = Math.max(Math.min(speed,maxSpeed), -10);

  // SVING (kun når bilen ruller)

  if(keys["a"]) car.rotation.y += turnStrength * (speed/maxSpeed);

  if(keys["d"]) car.rotation.y -= turnStrength * (speed/maxSpeed);

  car.translateZ(speed*0.1);

  // CHASE CAMERA

  const desiredCam = camOffset.clone().applyMatrix4(car.matrixWorld);

  camera.position.lerp(desiredCam, 0.1);

  camera.lookAt(car.position.x, car.position.y+1, car.position.z);

  // LYD pitch

  audio.playbackRate = 0.5 + Math.abs(speed)/maxSpeed;

  // SPEEDO

  const kmh = Math.abs(speed * 3.6).toFixed(0);

  hud.innerText = `${kmh} km/t`;

  renderer.render(scene,camera);

}

animate();
</script>
</body>
</html>
 
